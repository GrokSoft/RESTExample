var VERSION="1.8.1",p=console.log,util=require("util"),pathlib=require("path"),vm=require("vm"),http=require("http"),fs=require("fs"),warn=console.warn,child_process=require("child_process"),spawn=child_process.spawn,exec=child_process.exec,execFile=child_process.execFile,assert=require("assert");try{var moment=require("moment")}catch(a){moment=null}
var nodeVer=process.versions.node.split(".").map(Number),nodeSpawnSupportsStdio=0<nodeVer[0]||8<=nodeVer[1],_DEBUG=!1,OM_LONG=1,OM_JSON=2,OM_INSPECT=3,OM_SIMPLE=4,OM_SHORT=5,OM_BUNYAN=6,OM_FROM_NAME={"long":OM_LONG,paul:OM_LONG,json:OM_JSON,inspect:OM_INSPECT,simple:OM_SIMPLE,"short":OM_SHORT,bunyan:OM_BUNYAN},TRACE=10,DEBUG=20,INFO=30,WARN=40,ERROR=50,FATAL=60,levelFromName={trace:TRACE,debug:DEBUG,info:INFO,warn:WARN,error:ERROR,fatal:FATAL},nameFromLevel={},upperNameFromLevel={},upperPaddedNameFromLevel=
{};Object.keys(levelFromName).forEach(function(a){var b=levelFromName[a];nameFromLevel[b]=a;upperNameFromLevel[b]=a.toUpperCase();upperPaddedNameFromLevel[b]=(4===a.length?" ":"")+a.toUpperCase()});
var TIME_UTC=1,TIME_LOCAL=2,TIMEZONE_UTC_FORMATS={"long":"[[]YYYY-MM-DD[T]HH:mm:ss.SSS[Z][]]","short":"HH:mm:ss.SSS[Z]"},TIMEZONE_LOCAL_FORMATS={"long":"[[]YYYY-MM-DD[T]HH:mm:ss.SSSZ[]]","short":"HH:mm:ss.SSS"},currLine=null,child=null,usingAnsiCodes=!1,gUsingConditionOpts=!1,pager=null,stdout=process.stdout,readingStdin=!1;function getVersion(){return VERSION}var format=util.format;
if(!format)var inspect=util.inspect,formatRegExp=/%[sdj%]/g,format=function(a){if("string"!==typeof a){for(var b=[],c=0;c<arguments.length;c++)b.push(inspect(arguments[c]));return b.join(" ")}for(var c=1,d=arguments,e=d.length,b=String(a).replace(formatRegExp,function(a){if(c>=e)return a;switch(a){case "%s":return String(d[c++]);case "%d":return Number(d[c++]);case "%j":return JSON.stringify(d[c++]);case "%%":return"%";default:return a}}),f=d[c];c<e;f=d[++c])b=null===f||"object"!==typeof f?b+(" "+
f):b+(" "+inspect(f));return b};function indent(a){return"    "+a.split(/\r?\n/).join("\n    ")}function objCopy(a){if(null===a)return null;if(Array.isArray(a))return a.slice();var b={};Object.keys(a).forEach(function(c){b[c]=a[c]});return b}
function printHelp(){p("Usage:");p("  bunyan [OPTIONS] [FILE ...]");p("  ... | bunyan [OPTIONS]");p("  bunyan [OPTIONS] -p PID");p("");p("Filter and pretty-print Bunyan log file content.");p("");p("General options:");p("  -h, --help    print this help info and exit");p("  --version     print version of this command and exit");p("");p("Runtime log snooping (via DTrace, only on supported platforms):");p("  -p PID        Process bunyan:log-* probes from the process");p("                with the given PID. Can be used multiple times,");
p('                or specify all processes with "*", or a set of');p("                processes whose command & args match a pattern");p('                with "-p NAME".');p("");p("Filtering options:");p("  -l, --level LEVEL");p("                Only show messages at or above the specified level.");p("                You can specify level *names* or the internal numeric");p("                values.");p("  -c, --condition CONDITION");p("                Run each log message through the condition and");
p("                only show those that return truish. E.g.:");p("                    -c 'this.pid == 123'");p("                    -c 'this.level == DEBUG'");p("                    -c 'this.msg.indexOf(\"boom\") != -1'");p('                "CONDITION" must be legal JS code. `this` holds');p("                the log record. The TRACE, DEBUG, ... FATAL values");p("                are defined to help with comparing `this.level`.");p("  --strict      Suppress all but legal Bunyan JSON log lines. By default");
p("                non-JSON, and non-Bunyan lines are passed through.");p("");p("Output options:");p("  --pager       Pipe output into `less` (or $PAGER if set), if");p("                stdout is a TTY. This overrides $BUNYAN_NO_PAGER.");p("                Note: Paging is only supported on node >=0.8.");p("  --no-pager    Do not pipe output into a pager.");p("  --color       Colorize output. Defaults to try if output");p("                stream is a TTY.");p("  --no-color    Force no coloring (e.g. terminal doesn't support it)");
p("  -o, --output MODE");p("                Specify an output mode/format. One of");p("                  long: (the default) pretty");p("                  json: JSON output, 2-space indent");p('                  json-N: JSON output, N-space indent, e.g. "json-4"');p("                  bunyan: 0 indented JSON, bunyan's native format");p("                  inspect: node.js `util.inspect` output");p('                  short: like "long", but more concise');p("  -j            shortcut for `-o json`");
p("  -0            shortcut for `-o bunyan`");p("  -L, --time local");p("                Display time field in local time, rather than UTC.");p("");p("Environment Variables:");p("  BUNYAN_NO_COLOR    Set to a non-empty value to force no output ");p('                     coloring. See "--no-color".');p("  BUNYAN_NO_PAGER    Disable piping output to a pager. ");p('                     See "--no-pager".');p("");p("See <https://github.com/trentm/node-bunyan> for more complete docs.");p("Please report bugs to <https://github.com/trentm/node-bunyan/issues>.")}
var streams={};function gotRecord(a,b,c,d,e){streams[a].records.push({line:b,rec:c,time:new Date(c.time)});emitNextRecord(d,e)}function filterRecord(a,b){if(b.level&&a.level<b.level)return!1;if(b.condFuncs)for(var c=objCopy(a),d=0;d<b.condFuncs.length;d++){var e=b.condFuncs[d].call(c);if(!e)return!1}else if(b.condVm)for(d=0;d<b.condVm.length;d++)if(e=b.condVm[d].runInNewContext(a),!e)return!1;return!0}
function emitNextRecord(a,b){for(var c,d,e;;){e=void 0;d=!0;for(c in streams){if(null===streams[c].stream||!streams[c].done&&0===streams[c].records.length){d=!1;break}0<streams[c].records.length&&(void 0===e||streams[e].records[0].time>streams[c].records[0].time)&&(e=c)}if(!d||void 0===e){for(c in streams)streams[c].stream&&!streams[c].done&&(0<streams[c].records.length?streams[c].paused||(streams[c].paused=!0,streams[c].stream.pause()):streams[c].paused&&(streams[c].paused=!1,streams[c].stream.resume()));
break}d=streams[e].records.shift();emitRecord(d.rec,d.line,a,b)}}function funcWithReturnFromSnippet(a){-1===a.indexOf("return")&&(";"===a.substring(a.length-1)&&(a=a.substring(0,a.length-1)),a="return ("+a+")");var b=[];Object.keys(upperNameFromLevel).forEach(function(a){b.push(format("var %s = %d;",upperNameFromLevel[a],a))});b=b.join("\n")+"\n";return new Function(b+a)}
function parseArgv(a){var b={args:[],help:!1,color:null,paginate:null,outputMode:OM_LONG,jsonIndent:2,level:null,strict:!1,pids:null,pidsType:null,timeFormat:TIME_UTC};a=a.slice(2);for(var c=[],d={d:!0,o:!0,c:!0,l:!0,p:!0},e=0;e<a.length;e++)if("-"===a[e].charAt(0)&&"-"!==a[e].charAt(1)&&2<a[e].length)for(var f=a[e].slice(1).split(""),k=0;k<f.length;k++){if(c.push("-"+f[k]),d[f[k]]){f=f.slice(k+1).join("");f.length&&c.push(f);break}}else c.push(a[e]);a=c;var h=[];Object.keys(upperNameFromLevel).forEach(function(a){h.push(format("Object.prototype.%s = %s;",
upperNameFromLevel[a],a))});h=h.join("\n")+"\n";for(c=!1;0<a.length;)switch(d=a.shift(),d){case "--":c=!0;break;case "-h":case "--help":b.help=!0;break;case "--version":b.version=!0;break;case "--strict":b.strict=!0;break;case "--color":b.color=!0;break;case "--no-color":b.color=!1;break;case "--pager":b.paginate=!0;break;case "--no-pager":b.paginate=!1;break;case "-o":case "--output":d=a.shift();e=d.lastIndexOf("-");-1!==e&&(f=Number(d.slice(e+1)),isNaN(f)||(b.jsonIndent=f,d=d.slice(0,e)));b.outputMode=
OM_FROM_NAME[d];if(void 0===b.outputMode)throw Error('unknown output mode: "'+d+'"');break;case "-j":b.outputMode=OM_JSON;break;case "-0":b.outputMode=OM_BUNYAN;break;case "-L":b.timeFormat=TIME_LOCAL;if(!moment)throw Error('could not find moment package required for "-L"');break;case "--time":d=a.shift();switch(d){case "utc":b.timeFormat=TIME_UTC;break;case "local":b.timeFormat=TIME_LOCAL;if(!moment)throw Error('could not find moment package required for "--time=local"');break;case void 0:throw Error('missing argument to "--time"');
default:throw Error(format('invalid time format: "%s"',d));}break;case "-p":b.pids||(b.pids=[]);d=a.shift();e=+d;if(isNaN(e)&&"*"!==d){if(b.pidsType&&"name"!==b.pidsType)throw Error(format('cannot mix PID name and number arguments: "%s"',d));b.pidsType="name";b.pids=d}else{if(b.pidsType&&"num"!==b.pidsType)throw Error(format('cannot mix PID name and number arguments: "%s"',d));b.pidsType="num";b.pids||(b.pids=[]);b.pids.push(isNaN(e)?d:e)}break;case "-l":case "--level":d=a.shift();e=+d;isNaN(e)&&
(e=+levelFromName[d.toLowerCase()]);if(isNaN(e))throw Error('unknown level value: "'+d+'"');b.level=e;break;case "-c":case "--condition":gUsingConditionOpts=!0;e=a.shift();if(process.env.BUNYAN_EXEC&&"vm"===process.env.BUNYAN_EXEC){b.condVm=b.condVm||[];var d="bunyan-condition-"+b.condVm.length,e=h+e,g;try{g=vm.createScript(e,d)}catch(q){throw Error(format("illegal CONDITION code: %s\n  CONDITION script:\n%s\n  Error:\n%s",q,indent(e),indent(q.stack)));}try{g.runInNewContext(minValidRecord)}catch(q){throw Error(format("CONDITION code cannot safely filter a minimal Bunyan log record\n  CONDITION script:\n%s\n  Minimal Bunyan log record:\n%s\n  Filter error:\n%s",
indent(e),indent(JSON.stringify(minValidRecord,null,2)),indent(q.stack)));}b.condVm.push(g)}else b.condFuncs=b.condFuncs||[],b.condFuncs.push(funcWithReturnFromSnippet(e));break;default:if(!c&&0<d.length&&"-"===d[0])throw Error('unknown option "'+d+'"');b.args.push(d)}return b}function isInteger(a){return 0==a.search(/^-?[0-9]+$/)}
var colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};function stylizeWithColor(a,b){if(!a)return"";var c=colors[b];return c?"\u001b["+c[0]+"m"+a+"\u001b["+c[1]+"m":a}function stylizeWithoutColor(a,b){return a}function isValidRecord(a){return null==a.v||null==a.level||null==a.name||null==a.hostname||null==a.pid||null==a.time||null==a.msg?!1:!0}
var minValidRecord={v:0,level:INFO,name:"name",hostname:"hostname",pid:123,time:Date.now(),msg:"msg"};function handleLogLine(a,b,c,d){currLine=b;var e;if(b)if("{"!==b[0])c.strict||emit(b+"\n");else{try{e=JSON.parse(b)}catch(f){c.strict||emit(b+"\n");return}if(!isValidRecord(e))c.strict||emit(b+"\n");else if(filterRecord(e,c))return null===a?emitRecord(e,b,c,d):gotRecord(a,b,e,c,d)}else c.strict||emit(b+"\n")}
function emitRecord(a,b,c,d){var e=!1;switch(c.outputMode){case OM_SHORT:e=!0;case OM_LONG:var f=function(b){var c="";void 0!==b.statusCode&&(c+=format("HTTP/1.1 %s %s\n",b.statusCode,http.STATUS_CODES[b.statusCode]),delete b.statusCode);var d={string:!0,object:!0},e;b.header&&d[typeof b.header]?(e=b.header,delete b.header):b.headers&&d[typeof b.headers]&&(e=b.headers,delete b.headers);void 0!==e&&(c="string"===typeof e?c+e.trimRight():c+Object.keys(e).map(function(a){return a+": "+e[a]}).join("\n"));
void 0!==b.body?(d="object"===typeof b.body?JSON.stringify(b.body,null,2):b.body,0<d.length&&(c+="\n\n"+d),delete b.body):c=c.trimRight();b.trailer&&(c+="\n"+b.trailer);delete b.trailer;c&&r.push(indent(c));Object.keys(b).forEach(function(c){a["res."+c]=b[c]})};if(!isValidRecord(a))return emit(b+"\n");delete a.v;if(e||c.timeFormat!==TIME_UTC)if(moment||c.timeFormat!==TIME_UTC){var k=moment(a.time);switch(c.timeFormat){case TIME_UTC:b=TIMEZONE_UTC_FORMATS[e?"short":"long"];k.utc();break;case TIME_LOCAL:b=
TIMEZONE_LOCAL_FORMATS[e?"short":"long"];break;default:throw Error("unexpected timeFormat: "+c.timeFormat);}b=k.format(b)}else b=a.time.substr(11);else b="["+a.time+"]";b=d(b,"XXX");delete a.time;k=a.name;delete a.name;a.component&&(k+="/"+a.component);delete a.component;e||(k+="/"+a.pid);delete a.pid;var h=upperPaddedNameFromLevel[a.level]||"LVL"+a.level;c.color&&(h=d(h,{10:"white",20:"yellow",30:"cyan",40:"magenta",50:"red",60:"inverse"}[a.level]));delete a.level;c="";if(a.src&&a.src.file){var g=
a.src;c=g.func?format(" (%s:%d in %s)",g.file,g.line,g.func):format(" (%s:%d)",g.file,g.line);c=d(c,"green")}delete a.src;var q=a.hostname;delete a.hostname;var t=[],r=[];a.req_id&&t.push("req_id="+a.req_id);delete a.req_id;var x;-1!==a.msg.indexOf("\n")?(x="",r.push(indent(d(a.msg,"cyan")))):x=" "+d(a.msg,"cyan");delete a.msg;if(a.req&&"object"===typeof a.req){var m=a.req;delete a.req;var n=m.headers;n?"string"===typeof n?n="\n"+n:"object"===typeof n&&(n="\n"+Object.keys(n).map(function(a){return a+
": "+n[a]}).join("\n")):n="";g=format("%s %s HTTP/%s%s",m.method,m.url,m.httpVersion||"1.1",n);delete m.url;delete m.method;delete m.httpVersion;delete m.headers;m.body&&(g+="\n\n"+("object"===typeof m.body?JSON.stringify(m.body,null,2):m.body),delete m.body);m.trailers&&0<Object.keys(m.trailers)&&(g+="\n"+Object.keys(m.trailers).map(function(a){return a+": "+m.trailers[a]}).join("\n"));delete m.trailers;r.push(indent(g));Object.keys(m).forEach(function(b){a["req."+b]=m[b]})}if(a.client_req&&"object"===
typeof a.client_req){var l=a.client_req;delete a.client_req;var n=l.headers,v="",g="";l.address&&(v="\nHost: "+l.address,l.port&&(v+=":"+l.port));delete l.headers;delete l.address;delete l.port;g+=format("%s %s HTTP/%s%s%s",l.method,l.url,l.httpVersion||"1.1",v,n?"\n"+Object.keys(n).map(function(a){return a+": "+n[a]}).join("\n"):"");delete l.method;delete l.url;delete l.httpVersion;l.body&&(g+="\n\n"+("object"===typeof l.body?JSON.stringify(l.body,null,2):l.body),delete l.body);Object.keys(l).forEach(function(b){a["client_req."+
b]=l[b]});r.push(indent(g))}a.res&&"object"===typeof a.res&&(f(a.res),delete a.res);a.client_res&&"object"===typeof a.client_res&&(f(a.client_res),delete a.client_res);if(a.err&&a.err.stack){var w=a.err;"string"!==typeof w.stack?r.push(indent(w.stack.toString())):r.push(indent(w.stack));delete w.message;delete w.name;delete w.stack;Object.keys(w).forEach(function(b){a["err."+b]=w[b]});delete a.err}f=Object.keys(a);for(g=0;g<f.length;g++){var v=f[g],u=a[v],y=!1;"string"!==typeof u&&(u=JSON.stringify(u,
null,2),y=!0);-1!==u.indexOf("\n")||50<u.length?r.push(indent(v+": "+u)):y||-1==u.indexOf(" ")&&0!==u.length?t.push(v+"="+u):t.push(v+"="+JSON.stringify(u))}t=d(t.length?" ("+t.join(", ")+")":"","XXX");r=d(r.length?r.join("\n    --\n")+"\n":"","XXX");e?emit(format("%s %s %s:%s%s\n%s",b,h,k,x,t,r)):emit(format("%s %s: %s on %s%s:%s%s\n%s",b,h,k,q||"<no-hostname>",c,x,t,r));break;case OM_INSPECT:emit(util.inspect(a,!1,Infinity,!0)+"\n");break;case OM_BUNYAN:emit(JSON.stringify(a,null,0)+"\n");break;
case OM_JSON:emit(JSON.stringify(a,null,c.jsonIndent)+"\n");break;case OM_SIMPLE:if(!isValidRecord(a))return emit(b+"\n");emit(format("%s - %s\n",upperNameFromLevel[a.level]||"LVL"+a.level,a.msg));break;default:throw Error("unknown output mode: "+c.outputMode);}}var stdoutFlushed=!0;function emit(a){try{stdoutFlushed=stdout.write(a)}catch(b){}}
function drainStdoutAndExit(a){_DEBUG&&warn("(drainStdoutAndExit(%d))",a);stdout.on("drain",function(){cleanupAndExit(a)});stdoutFlushed&&cleanupAndExit(a)}
function processStdin(a,b,c){readingStdin=!0;var d="",e=process.stdin;e.resume();e.setEncoding("utf8");e.on("data",function(c){c=c.split(/\r\n|\n/);var e=c.length;if(1===e)d+=c[0];else{1<e&&handleLogLine(null,d+c[0],a,b);d=c.pop();--e;for(var h=1;h<e;h++)handleLogLine(null,c[h],a,b)}});e.on("end",function(){d&&(handleLogLine(null,d,a,b),d="");c()})}
function processPids(a,b,c){var d="";(function(b){if("num"===a.pidsType)return b(null,a.pids);if("sunos"===process.platform)execFile("/bin/pgrep",["-lf",a.pids],function(c,d,f){if(c)return warn('bunyan: error getting PIDs for "%s": %s\n%s\n%s',a.pids,c.message,d,f),b(1);c=d.trim().split("\n").map(function(a){return a.trim().split(/\s+/)[0]}).filter(function(a){return Number(a)!==process.pid});if(0===c.length)return warn('bunyan: error: no matching PIDs found for "%s"',a.pids),b(2);b(null,c)});else{var c=
a.pids;c&&/[a-zA-Z0-9_]/.test(c[0])&&(c="["+c[0]+"]"+c.slice(1));exec(format("ps -A -o pid,command | grep '%s'",c),function(c,d,f){if(c)return warn('bunyan: error getting PIDs for "%s": %s\n%s\n%s',a.pids,c.message,d,f),b(1);c=d.trim().split("\n").map(function(a){return a.trim().split(/\s+/)[0]}).filter(function(a){return Number(a)!==process.pid});if(0===c.length)return warn('bunyan: error: no matching PIDs found for "%s"',a.pids),b(2);b(null,c)})}})(function(e,f){function k(e){d&&(handleLogLine(null,
d,a,b),d="");c(e)}if(e)return c(e);var h=f.map(function(b){if(!a.level)return format("bunyan%s:::log-*",b);var c=[],d;for(d in levelFromName)levelFromName[d]>=a.level&&c.push(format("bunyan%s:::log-%s",b,d));if(0!=c.length)return c.join(",");warn("bunyan: error: level (%d) exceeds maximum logging level",a.level);return drainStdoutAndExit(1)}).join(","),h=["dtrace","-Z","-x","strsize=4k","-x","switchrate=10hz","-qn",format('%s{printf("%s", copyinstr(arg0))}',h)],h=spawn(h[0],h.slice(1),{stdio:["pipe",
"pipe",process.stderr]});h.on("error",function(a){"spawn"===a.syscall&&"ENOENT"===a.errno?console.error('bunyan: error: could not spawn "dtrace" ("bunyan -p" is only supported on platforms with dtrace)'):console.error("bunyan: error: unexpected dtrace error: %s",a);c(1)});child=h;h.stdout.setEncoding("utf8");h.stdout.on("data",function(c){c=c.split(/\r\n|\n/);var e=c.length;if(1===e)d+=c[0];else{1<e&&handleLogLine(null,d+c[0],a,b);d=c.pop();--e;for(var f=1;f<e;f++)handleLogLine(null,c[f],a,b)}});
if(nodeSpawnSupportsStdio)h.on("exit",k);else{var g=function(a){q=a;t--;0==t&&k(q)},q=null,t=3;h.stderr.pipe(process.stderr);h.stderr.on("end",g);h.stderr.on("end",g);h.on("exit",g)}})}
function processFile(a,b,c,d){var e=fs.createReadStream(a);/\.gz$/.test(a)&&(e=e.pipe(require("zlib").createGunzip()));var f=new (require("string_decoder").StringDecoder)("utf8");streams[a].stream=e;e.on("error",function(b){streams[a].done=!0;d(b)});var k="";e.on("data",function(d){d=f.write(d);if(d.length){d=d.split(/\r\n|\n/);var e=d.length;if(1===e)k+=d[0];else{1<e&&handleLogLine(a,k+d[0],b,c);k=d.pop();--e;for(var q=1;q<e;q++)handleLogLine(a,d[q],b,c)}}});e.on("end",function(){streams[a].done=
!0;k?(handleLogLine(a,k,b,c),k=""):emitNextRecord(b,c);d()})}function asyncForEach(a,b,c){c=c||function(){};if(!a.length)return c();var d=0;a.forEach(function(e){b(e,function(b){b?(c(b),c=function(){}):(d+=1,d===a.length&&c())})})}var cleanedUp=!1;
function cleanupAndExit(a,b){cleanedUp||(cleanedUp=!0,_DEBUG&&warn("(bunyan: cleanupAndExit)"),usingAnsiCodes&&stdout.write("\u001b[0m"),child&&child.kill(b),pager?(stdout.end(),pager.on("exit",function(b){_DEBUG&&warn("(bunyan: pager exit -> process.exit(%s))",b||a);process.exit(b||a)})):(_DEBUG&&warn("(bunyan: process.exit(%s))",a),process.exit(a)))}process.on("SIGINT",function(){readingStdin||cleanupAndExit(1,"SIGINT")});process.on("SIGQUIT",function(){cleanupAndExit(1,"SIGQUIT")});
process.on("SIGTERM",function(){cleanupAndExit(1,"SIGTERM")});process.on("SIGHUP",function(){cleanupAndExit(1,"SIGHUP")});
process.on("uncaughtException",function(a){var b=encodeURIComponent(format("Bunyan %s crashed: %s",getVersion(),String(a))),c=console.error;c("```");c("* The Bunyan CLI crashed!");c("*");"ReferenceError"===a.name&&gUsingConditionOpts&&(c('* This crash was due to a "ReferenceError", which is often the result of given'),c("* `-c CONDITION` code that doesn't guard against undefined values. If that is"),c("* not the problem:"),c("*"));c("* Please report this issue and include the details below:");c("*");
c("*    https://github.com/trentm/node-bunyan/issues/new?title=%s",b);c("*");c("* * *");c("* platform:",process.platform);c("* node version:",process.version);c("* bunyan version:",getVersion());c("* argv: %j",process.argv);c("* log line: %j",currLine);c("* stack:");a=a.stack.split(/\r?\n/);for(b=0;b<a.length;b++)a[b]="*     "+a[b];a=a.join("\n");c(a);c("```");process.exit(1)});
function main(a){try{var b=parseArgv(a)}catch(f){return warn("bunyan: error: %s",f.message),drainStdoutAndExit(1)}if(b.help)printHelp();else if(b.version)console.log("bunyan "+getVersion());else{if(b.pid&&0<b.args.length)return warn('bunyan: error: can\'t use both "-p PID" (%s) and file (%s) args',b.pid,b.args.join(" ")),drainStdoutAndExit(1);null===b.color&&(b.color=process.env.BUNYAN_NO_COLOR&&0<process.env.BUNYAN_NO_COLOR.length?!1:process.stdout.isTTY);var c=(usingAnsiCodes=b.color)?stylizeWithColor:
stylizeWithoutColor;if(process.stdout.isTTY&&process.stdin.isTTY&&!b.pids&&0<b.args.length&&"win32"!==process.platform&&(0<nodeVer[0]||8<=nodeVer[1])&&(!0===b.paginate||!1!==b.paginate&&(!process.env.BUNYAN_NO_PAGER||0===process.env.BUNYAN_NO_PAGER.length))){a=process.env.PAGER||"less";assert.ok(-1===a.indexOf('"')&&-1===a.indexOf("'"),"cannot parse PAGER quotes yet");a=a.split(/\s+/g);var d=objCopy(process.env);void 0===d.LESS&&(d.LESS="FRX");_DEBUG&&warn("(pager: argv=%j, env.LESS=%j)",a,d.LESS);
pager=spawn(a[0],a.slice(1),{env:d,stdio:["pipe",1,2]});stdout=pager.stdin;pager.on("exit",function(a){_DEBUG&&warn("(bunyan: pager exit)");pager=null;stdout.end();stdout=process.stdout;cleanupAndExit(a)})}stdout.on("error",function(a){_DEBUG&&warn("(stdout error event: %s)",a);"EPIPE"===a.code?drainStdoutAndExit(0):("Error: This socket is closed."!==a.toString()&&warn(a),drainStdoutAndExit(1))});var e=0;b.pids?processPids(b,c,function(a){cleanupAndExit(a)}):0<b.args.length?(a=b.args,a.forEach(function(a){streams[a]=
{stream:null,records:[],done:!1}}),asyncForEach(a,function(a,d){processFile(a,b,c,function(a){a&&(warn("bunyan: %s",a.message),e+=1);d()})},function(a){if(a)return warn("bunyan: unexpected error: %s",a.stack||a),drainStdoutAndExit(1);cleanupAndExit(e)})):processStdin(b,c,function(){cleanupAndExit(e)})}}require.main===module&&([0,6,0]<=nodeVer&&nodeVer<=[0,6,8]&&(stdout=process.stdout,stdout.end=stdout.destroy=stdout.destroySoon=function(){}),main(process.argv)); //# sourceMappingURL=bunyan.map
