var test=require("tap").test,sys=require("sys"),BerWriter,BerReader;test("load library",function(b){BerWriter=require("../../lib/index").BerWriter;b.ok(BerWriter);b.ok(new BerWriter);b.end()});test("write byte",function(b){var a=new BerWriter;a.writeByte(194);a=a.buffer;b.ok(a);b.equal(a.length,1,"Wrong length");b.equal(a[0],194,"value wrong");b.end()});
test("write 1 byte int",function(b){var a=new BerWriter;a.writeInt(127);a=a.buffer;b.ok(a);b.equal(a.length,3,"Wrong length for an int: "+a.length);b.equal(a[0],2,"ASN.1 tag wrong (2) -> "+a[0]);b.equal(a[1],1,"length wrong(1) -> "+a[1]);b.equal(a[2],127,"value wrong(3) -> "+a[2]);b.end()});
test("write 2 byte int",function(b){var a=new BerWriter;a.writeInt(32766);a=a.buffer;b.ok(a);b.equal(a.length,4,"Wrong length for an int");b.equal(a[0],2,"ASN.1 tag wrong");b.equal(a[1],2,"length wrong");b.equal(a[2],127,"value wrong (byte 1)");b.equal(a[3],254,"value wrong (byte 2)");b.end()});
test("write 3 byte int",function(b){var a=new BerWriter;a.writeInt(8388606);a=a.buffer;b.ok(a);b.equal(a.length,5,"Wrong length for an int");b.equal(a[0],2,"ASN.1 tag wrong");b.equal(a[1],3,"length wrong");b.equal(a[2],127,"value wrong (byte 1)");b.equal(a[3],255,"value wrong (byte 2)");b.equal(a[4],254,"value wrong (byte 3)");b.end()});
test("write 4 byte int",function(b){var a=new BerWriter;a.writeInt(2147483646);a=a.buffer;b.ok(a);b.equal(a.length,6,"Wrong length for an int");b.equal(a[0],2,"ASN.1 tag wrong");b.equal(a[1],4,"length wrong");b.equal(a[2],127,"value wrong (byte 1)");b.equal(a[3],255,"value wrong (byte 2)");b.equal(a[4],255,"value wrong (byte 3)");b.equal(a[5],254,"value wrong (byte 4)");b.end()});
test("write boolean",function(b){var a=new BerWriter;a.writeBoolean(!0);a.writeBoolean(!1);a=a.buffer;b.ok(a);b.equal(a.length,6,"Wrong length");b.equal(a[0],1,"tag wrong");b.equal(a[1],1,"length wrong");b.equal(a[2],255,"value wrong");b.equal(a[3],1,"tag wrong");b.equal(a[4],1,"length wrong");b.equal(a[5],0,"value wrong");b.end()});
test("write string",function(b){var a=new BerWriter;a.writeString("hello world");a=a.buffer;b.ok(a);b.equal(a.length,13,"wrong length");b.equal(a[0],4,"wrong tag");b.equal(a[1],11,"wrong length");b.equal(a.slice(2).toString("utf8"),"hello world","wrong value");b.end()});
test("write buffer",function(b){var a=new BerWriter;a.writeString("hello world");var c=a.buffer,d=new Buffer([4,11,48,9,2,1,15,1,1,255,1,1,255]);a.writeBuffer(d.slice(2,d.length),4);c=a.buffer;b.ok(c);b.equal(c.length,26,"wrong length");b.equal(c[0],4,"wrong tag");b.equal(c[1],11,"wrong length");b.equal(c.slice(2,13).toString("utf8"),"hello world","wrong value");b.equal(c[13],d[0],"wrong tag");b.equal(c[14],d[1],"wrong length");for(var a=13,e=0;a<c.length&&e<d.length;a++,e++)b.equal(c[a],d[e],"buffer contents not identical");
b.end()});test("write string array",function(b){var a=new BerWriter;a.writeStringArray(["hello world","fubar!"]);a=a.buffer;b.ok(a);b.equal(a.length,21,"wrong length");b.equal(a[0],4,"wrong tag");b.equal(a[1],11,"wrong length");b.equal(a.slice(2,13).toString("utf8"),"hello world","wrong value");b.equal(a[13],4,"wrong tag");b.equal(a[14],6,"wrong length");b.equal(a.slice(15).toString("utf8"),"fubar!","wrong value");b.end()});
test("resize internal buffer",function(b){var a=new BerWriter({size:2});a.writeString("hello world");a=a.buffer;b.ok(a);b.equal(a.length,13,"wrong length");b.equal(a[0],4,"wrong tag");b.equal(a[1],11,"wrong length");b.equal(a.slice(2).toString("utf8"),"hello world","wrong value");b.end()});
test("sequence",function(b){var a=new BerWriter({size:25});a.startSequence();a.writeString("hello world");a.endSequence();a=a.buffer;b.ok(a);console.log(a);b.equal(a.length,15,"wrong length");b.equal(a[0],48,"wrong tag");b.equal(a[1],13,"wrong length");b.equal(a[2],4,"wrong tag");b.equal(a[3],11,"wrong length");b.equal(a.slice(4).toString("utf8"),"hello world","wrong value");b.end()});
test("nested sequence",function(b){var a=new BerWriter({size:25});a.startSequence();a.writeString("hello world");a.startSequence();a.writeString("hello world");a.endSequence();a.endSequence();a=a.buffer;b.ok(a);b.equal(a.length,30,"wrong length");b.equal(a[0],48,"wrong tag");b.equal(a[1],28,"wrong length");b.equal(a[2],4,"wrong tag");b.equal(a[3],11,"wrong length");b.equal(a.slice(4,15).toString("utf8"),"hello world","wrong value");b.equal(a[15],48,"wrong tag");b.equal(a[16],13,"wrong length");b.equal(a[17],
4,"wrong tag");b.equal(a[18],11,"wrong length");b.equal(a.slice(19,30).toString("utf8"),"hello world","wrong value");b.end()});
test("LDAP bind message",function(b){var a=new BerWriter;a.startSequence();a.writeInt(3);a.startSequence(96);a.writeInt(3);a.writeString("cn=foo,ou=unit,o=test");a.writeByte(128);a.writeByte(0);a.endSequence();a.endSequence();a=a.buffer;b.ok(a);b.equal(a.length,35,"wrong length (buffer)");b.equal(a[0],48,"wrong tag");b.equal(a[1],33,"wrong length");b.equal(a[2],2,"wrong tag");b.equal(a[3],1,"wrong length");b.equal(a[4],3,"wrong value");b.equal(a[5],96,"wrong tag");b.equal(a[6],28,"wrong length");
b.equal(a[7],2,"wrong tag");b.equal(a[8],1,"wrong length");b.equal(a[9],3,"wrong value");b.equal(a[10],4,"wrong tag");b.equal(a[11],21,"wrong length");b.equal(a.slice(12,33).toString("utf8"),"cn=foo,ou=unit,o=test","wrong value");b.equal(a[33],128,"wrong tag");b.equal(a[34],0,"wrong len");b.end()});
test("Write OID",function(b){var a=new BerWriter;a.writeOID("1.2.840.113549.1.1.1");a=a.buffer;b.ok(a);console.log(require("util").inspect(a));console.log(require("util").inspect(new Buffer([6,9,42,134,72,134,247,13,1,1,1])));b.end()}); //# sourceMappingURL=writer.test.js.map
