var assert=require("assert"),https=require("https"),http=require("http"),util=require("util"),transport=require("spdy-transport"),fixtures=require("./fixtures"),spdy=require("../");
describe("SPDY Client",function(){describe("regular",function(){fixtures.everyConfig(function(h,g,k,d){var f,c,e;beforeEach(function(b){e=d?http:https;var a=util._extend({spdy:{plain:d}},fixtures.keys);f=spdy.createServer(a,function(a,b){var c="";a.on("data",function(a){c+=a});a.on("end",function(){b.writeHead(200,a.headers);b.addTrailers({trai:"ler"});var d=b.push("/push",{request:{push:"yes"}},function(a){assert(!a);d.end("push");d.on("error",function(){});b.end(c||"okay")})})});f.listen(fixtures.port,
function(){c=spdy.createAgent({rejectUnauthorized:!1,port:fixtures.port,spdy:{plain:d,protocol:d?g:null,protocols:[g]}});b()})});afterEach(function(b){function a(){0===--l&&b()}var l=2;c.close(a);f.close(a)});it("should send GET request",function(b){e.request({agent:c,method:"GET",path:"/get",headers:{a:"b"}},function(a){assert.equal(a.statusCode,200);assert.equal(a.headers.a,"b");fixtures.expectData(a,"okay",b)}).end()});it("should send POST request",function(b){var a=e.request({agent:c,method:"POST",
path:"/post",headers:{post:"headers"}},function(a){assert.equal(a.statusCode,200);assert.equal(a.headers.post,"headers");fixtures.expectData(a,"post body",b)});c._spdyState.socket.once(d?"connect":"secureConnect",function(){a.end("post body")})});it("should receive PUSH_PROMISE",function(b){var a=e.request({agent:c,method:"GET",path:"/get"},function(a){assert.equal(a.statusCode,200);a.resume()});a.on("push",function(a){assert.equal(a.path,"/push");assert.equal(a.headers.push,"yes");a.resume();a.once("end",
b)});a.end()});it("should receive trailing headers",function(b){e.request({agent:c,method:"GET",path:"/get"},function(a){assert.equal(a.statusCode,200);a.on("trailers",function(c){assert.equal(c.trai,"ler");fixtures.expectData(a,"okay",b)})}).end()})})});describe("x-forwarded-for",function(){fixtures.everyConfig(function(h,g,k,d){var f,c,e;beforeEach(function(b){e=d?http:https;var a=util._extend({spdy:{plain:d,"x-forwarded-for":!0}},fixtures.keys);f=spdy.createServer(a,function(a,b){b.writeHead(200,
a.headers);b.end()});f.listen(fixtures.port,function(){c=spdy.createAgent({rejectUnauthorized:!1,port:fixtures.port,spdy:{"x-forwarded-for":"1.2.3.4",plain:d,protocol:d?g:null,protocols:[g]}});b()})});afterEach(function(b){function a(){0===--d&&b()}var d=2;c.close(a);f.close(a)});it("should send x-forwarded-for",function(b){e.request({agent:c,method:"GET",path:"/get"},function(a){assert.equal(a.statusCode,200);assert.equal(a.headers["x-forwarded-for"],"1.2.3.4");a.resume();a.once("end",b)}).end()})})})}); //# sourceMappingURL=client-test.js.map
