module.exports=globSync;globSync.GlobSync=GlobSync;var fs=require("fs"),minimatch=require("minimatch"),Minimatch=minimatch.Minimatch,Glob=require("./glob.js").Glob,util=require("util"),path=require("path"),assert=require("assert"),isAbsolute=require("path-is-absolute"),common=require("./common.js"),alphasort=common.alphasort,alphasorti=common.alphasorti,setopts=common.setopts,ownProp=common.ownProp,childrenIgnored=common.childrenIgnored;
function globSync(a,b){if("function"===typeof b||3===arguments.length)throw new TypeError("callback provided to sync glob\nSee: https://github.com/isaacs/node-glob/issues/167");return(new GlobSync(a,b)).found}
function GlobSync(a,b){if(!a)throw Error("must provide pattern");if("function"===typeof b||3===arguments.length)throw new TypeError("callback provided to sync glob\nSee: https://github.com/isaacs/node-glob/issues/167");if(!(this instanceof GlobSync))return new GlobSync(a,b);setopts(this,a,b);if(this.noprocess)return this;var c=this.minimatch.set.length;this.matches=Array(c);for(var d=0;d<c;d++)this._process(this.minimatch.set[d],d,!1);this._finish()}
GlobSync.prototype._finish=function(){assert(this instanceof GlobSync);if(this.realpath){var a=this;this.matches.forEach(function(b,c){var d=a.matches[c]=Object.create(null),e;for(e in b)try{e=a._makeAbs(e);var g=fs.realpathSync(e,a.realpathCache);d[g]=!0}catch(l){if("stat"===l.syscall)d[a._makeAbs(e)]=!0;else throw l;}})}common.finish(this)};
GlobSync.prototype._process=function(a,b,c){assert(this instanceof GlobSync);for(var d=0;"string"===typeof a[d];)d++;var e;switch(d){case a.length:this._processSimple(a.join("/"),b);return;case 0:e=null;break;default:e=a.slice(0,d).join("/")}d=a.slice(d);if(null===e)a=".";else{if(isAbsolute(e)||isAbsolute(a.join("/")))e&&isAbsolute(e)||(e="/"+e);a=e}var g=this._makeAbs(a);childrenIgnored(this,a)||(d[0]===minimatch.GLOBSTAR?this._processGlobStar(e,a,g,d,b,c):this._processReaddir(e,a,g,d,b,c))};
GlobSync.prototype._processReaddir=function(a,b,c,d,e,g){if(b=this._readdir(c,g)){c=d[0];for(var l=!!this.minimatch.negate,k=c._glob,m=this.dot||"."===k.charAt(0),k=[],h=0;h<b.length;h++){var f=b[h];("."!==f.charAt(0)||m)&&(l&&!a?!f.match(c):f.match(c))&&k.push(f)}b=k.length;if(0!==b)if(1!==d.length||this.mark||this.stat)for(d.shift(),h=0;h<b;h++)f=k[h],this._process((a?[a,f]:[f]).concat(d),e,g);else for(this.matches[e]||(this.matches[e]=Object.create(null)),h=0;h<b;h++)f=k[h],a&&(f="/"!==a.slice(-1)?
a+"/"+f:a+f),"/"!==f.charAt(0)||this.nomount||(f=path.join(this.root,f)),this.matches[e][f]=!0}};GlobSync.prototype._emitMatch=function(a,b){this._makeAbs(b);this.mark&&(b=this._mark(b));if(!this.matches[a][b]){if(this.nodir){var c=this.cache[this._makeAbs(b)];if("DIR"===c||Array.isArray(c))return}this.matches[a][b]=!0;this.stat&&this._stat(b)}};
GlobSync.prototype._readdirInGlobStar=function(a){if(this.follow)return this._readdir(a,!1);var b,c;try{c=fs.lstatSync(a)}catch(e){return null}var d=c.isSymbolicLink();(this.symlinks[a]=d)||c.isDirectory()?b=this._readdir(a,!1):this.cache[a]="FILE";return b};
GlobSync.prototype._readdir=function(a,b){if(b&&!ownProp(this.symlinks,a))return this._readdirInGlobStar(a);if(ownProp(this.cache,a)){var c=this.cache[a];if(!c||"FILE"===c)return null;if(Array.isArray(c))return c}try{return this._readdirEntries(a,fs.readdirSync(a))}catch(d){return this._readdirError(a,d),null}};GlobSync.prototype._readdirEntries=function(a,b){if(!this.mark&&!this.stat)for(var c=0;c<b.length;c++){var d=b[c],d="/"===a?a+d:a+"/"+d;this.cache[d]=!0}return this.cache[a]=b};
GlobSync.prototype._readdirError=function(a,b){switch(b.code){case "ENOTSUP":case "ENOTDIR":this.cache[this._makeAbs(a)]="FILE";break;case "ENOENT":case "ELOOP":case "ENAMETOOLONG":case "UNKNOWN":this.cache[this._makeAbs(a)]=!1;break;default:this.cache[this._makeAbs(a)]=!1;if(this.strict)throw b;this.silent||console.error("glob error",b)}};
GlobSync.prototype._processGlobStar=function(a,b,c,d,e,g){if(b=this._readdir(c,g)){var l=d.slice(1);a=a?[a]:[];var k=a.concat(l);this._process(k,e,!1);k=b.length;if(!this.symlinks[c]||!g)for(c=0;c<k;c++)if("."!==b[c].charAt(0)||this.dot)g=a.concat(b[c],l),this._process(g,e,!0),g=a.concat(b[c],d),this._process(g,e,!0)}};
GlobSync.prototype._processSimple=function(a,b){var c=this._stat(a);this.matches[b]||(this.matches[b]=Object.create(null));c&&(a&&isAbsolute(a)&&!this.nomount&&(c=/[\/\\]$/.test(a),"/"===a.charAt(0)?a=path.join(this.root,a):(a=path.resolve(this.root,a),c&&(a+="/"))),"win32"===process.platform&&(a=a.replace(/\\/g,"/")),this.matches[b][a]=!0)};
GlobSync.prototype._stat=function(a){var b=this._makeAbs(a),c="/"===a.slice(-1);if(a.length>this.maxLength)return!1;if(!this.stat&&ownProp(this.cache,b)){a=this.cache[b];Array.isArray(a)&&(a="DIR");if(!c||"DIR"===a)return a;if(c&&"FILE"===a)return!1}a=this.statCache[b];if(!a){var d;try{d=fs.lstatSync(b)}catch(e){return!1}if(d.isSymbolicLink())try{a=fs.statSync(b)}catch(e){a=d}else a=d}this.statCache[b]=a;a=a.isDirectory()?"DIR":"FILE";this.cache[b]=this.cache[b]||a;return c&&"DIR"!==a?!1:a};
GlobSync.prototype._mark=function(a){return common.mark(this,a)};GlobSync.prototype._makeAbs=function(a){return common.makeAbs(this,a)}; //# sourceMappingURL=sync.js.map
