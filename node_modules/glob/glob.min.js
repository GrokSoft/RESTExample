module.exports=glob;
var fs=require("fs"),minimatch=require("minimatch"),Minimatch=minimatch.Minimatch,inherits=require("inherits"),EE=require("events").EventEmitter,path=require("path"),assert=require("assert"),isAbsolute=require("path-is-absolute"),globSync=require("./sync.js"),common=require("./common.js"),alphasort=common.alphasort,alphasorti=common.alphasorti,setopts=common.setopts,ownProp=common.ownProp,inflight=require("inflight"),util=require("util"),childrenIgnored=common.childrenIgnored,isIgnored=common.isIgnored,
once=require("once");function glob(a,b,c){"function"===typeof b&&(c=b,b={});b||(b={});if(b.sync){if(c)throw new TypeError("callback provided to sync glob");return globSync(a,b)}return new Glob(a,b,c)}glob.sync=globSync;var GlobSync=glob.GlobSync=globSync.GlobSync;glob.glob=glob;function extend(a,b){if(null===b||"object"!==typeof b)return a;for(var c=Object.keys(b),d=c.length;d--;)a[c[d]]=b[c[d]];return a}
glob.hasMagic=function(a,b){var c=extend({},b);c.noprocess=!0;c=(new Glob(a,c)).minimatch.set;if(1<c.length)return!0;for(var d=0;d<c[0].length;d++)if("string"!==typeof c[0][d])return!0;return!1};glob.Glob=Glob;inherits(Glob,EE);
function Glob(a,b,c){function d(){--e._processing;0>=e._processing&&e._finish()}"function"===typeof b&&(c=b,b=null);if(b&&b.sync){if(c)throw new TypeError("callback provided to sync glob");return new GlobSync(a,b)}if(!(this instanceof Glob))return new Glob(a,b,c);setopts(this,a,b);this._didRealPath=!1;a=this.minimatch.set.length;this.matches=Array(a);"function"===typeof c&&(c=once(c),this.on("error",c),this.on("end",function(a){c(null,a)}));var e=this;a=this.minimatch.set.length;this._processing=
0;this.matches=Array(a);this._emitQueue=[];this._processQueue=[];this.paused=!1;if(this.noprocess)return this;if(0===a)return d();for(b=0;b<a;b++)this._process(this.minimatch.set[b],b,!1,d)}Glob.prototype._finish=function(){assert(this instanceof Glob);if(!this.aborted){if(this.realpath&&!this._didRealpath)return this._realpath();common.finish(this);this.emit("end",this.found)}};
Glob.prototype._realpath=function(){function a(){0===--b&&c._finish()}if(!this._didRealpath){this._didRealpath=!0;var b=this.matches.length;if(0===b)return this._finish();for(var c=this,d=0;d<this.matches.length;d++)this._realpathSet(d,a)}};
Glob.prototype._realpathSet=function(a,b){var c=this.matches[a];if(!c)return b();var c=Object.keys(c),d=this,e=c.length;if(0===e)return b();var f=this.matches[a]=Object.create(null);c.forEach(function(c,h){c=d._makeAbs(c);fs.realpath(c,d.realpathCache,function(h,n){h?"stat"===h.syscall?f[c]=!0:d.emit("error",h):f[n]=!0;0===--e&&(d.matches[a]=f,b())})})};Glob.prototype._mark=function(a){return common.mark(this,a)};Glob.prototype._makeAbs=function(a){return common.makeAbs(this,a)};
Glob.prototype.abort=function(){this.aborted=!0;this.emit("abort")};Glob.prototype.pause=function(){this.paused||(this.paused=!0,this.emit("pause"))};
Glob.prototype.resume=function(){if(this.paused){this.emit("resume");this.paused=!1;if(this._emitQueue.length)for(var a=this._emitQueue.slice(0),b=this._emitQueue.length=0;b<a.length;b++){var c=a[b];this._emitMatch(c[0],c[1])}if(this._processQueue.length)for(a=this._processQueue.slice(0),b=this._processQueue.length=0;b<a.length;b++)c=a[b],this._processing--,this._process(c[0],c[1],c[2],c[3])}};
Glob.prototype._process=function(a,b,c,d){assert(this instanceof Glob);assert("function"===typeof d);if(!this.aborted)if(this._processing++,this.paused)this._processQueue.push([a,b,c,d]);else{for(var e=0;"string"===typeof a[e];)e++;var f;switch(e){case a.length:this._processSimple(a.join("/"),b,d);return;case 0:f=null;break;default:f=a.slice(0,e).join("/")}e=a.slice(e);if(null===f)a=".";else{if(isAbsolute(f)||isAbsolute(a.join("/")))f&&isAbsolute(f)||(f="/"+f);a=f}var g=this._makeAbs(a);if(childrenIgnored(this,
a))return d();e[0]===minimatch.GLOBSTAR?this._processGlobStar(f,a,g,e,b,c,d):this._processReaddir(f,a,g,e,b,c,d)}};Glob.prototype._processReaddir=function(a,b,c,d,e,f,g){var h=this;this._readdir(c,f,function(l,n){return h._processReaddir2(a,b,c,d,e,f,n,g)})};
Glob.prototype._processReaddir2=function(a,b,c,d,e,f,g,h){if(!g)return h();b=d[0];c=!!this.minimatch.negate;for(var l=b._glob,n=this.dot||"."===l.charAt(0),l=[],m=0;m<g.length;m++){var k=g[m];("."!==k.charAt(0)||n)&&(c&&!a?!k.match(b):k.match(b))&&l.push(k)}g=l.length;if(0===g)return h();if(1===d.length&&!this.mark&&!this.stat){this.matches[e]||(this.matches[e]=Object.create(null));for(m=0;m<g;m++)k=l[m],a&&(k="/"!==a?a+"/"+k:a+k),"/"!==k.charAt(0)||this.nomount||(k=path.join(this.root,k)),this._emitMatch(e,
k);return h()}d.shift();for(m=0;m<g;m++)k=l[m],a&&(k="/"!==a?a+"/"+k:a+k),this._process([k].concat(d),e,f,h);h()};Glob.prototype._emitMatch=function(a,b){if(!this.aborted&&!this.matches[a][b]&&!isIgnored(this,b))if(this.paused)this._emitQueue.push([a,b]);else{var c=this._makeAbs(b);if(this.nodir){var d=this.cache[c];if("DIR"===d||Array.isArray(d))return}this.mark&&(b=this._mark(b));this.matches[a][b]=!0;(c=this.statCache[c])&&this.emit("stat",b,c);this.emit("match",b)}};
Glob.prototype._readdirInGlobStar=function(a,b){function c(c,e){if(c)return b();var h=e.isSymbolicLink();(d.symlinks[a]=h)||e.isDirectory()?d._readdir(a,!1,b):(d.cache[a]="FILE",b())}if(!this.aborted){if(this.follow)return this._readdir(a,!1,b);var d=this,e=inflight("lstat\x00"+a,c);e&&fs.lstat(a,e)}};
Glob.prototype._readdir=function(a,b,c){if(!this.aborted&&(c=inflight("readdir\x00"+a+"\x00"+b,c))){if(b&&!ownProp(this.symlinks,a))return this._readdirInGlobStar(a,c);if(ownProp(this.cache,a)){b=this.cache[a];if(!b||"FILE"===b)return c();if(Array.isArray(b))return c(null,b)}fs.readdir(a,readdirCb(this,a,c))}};function readdirCb(a,b,c){return function(d,e){d?a._readdirError(b,d,c):a._readdirEntries(b,e,c)}}
Glob.prototype._readdirEntries=function(a,b,c){if(!this.aborted){if(!this.mark&&!this.stat)for(var d=0;d<b.length;d++){var e=b[d],e="/"===a?a+e:a+"/"+e;this.cache[e]=!0}this.cache[a]=b;return c(null,b)}};
Glob.prototype._readdirError=function(a,b,c){if(!this.aborted){switch(b.code){case "ENOTSUP":case "ENOTDIR":this.cache[this._makeAbs(a)]="FILE";break;case "ENOENT":case "ELOOP":case "ENAMETOOLONG":case "UNKNOWN":this.cache[this._makeAbs(a)]=!1;break;default:this.cache[this._makeAbs(a)]=!1,this.strict&&(this.emit("error",b),this.abort()),this.silent||console.error("glob error",b)}return c()}};
Glob.prototype._processGlobStar=function(a,b,c,d,e,f,g){var h=this;this._readdir(c,f,function(l,n){h._processGlobStar2(a,b,c,d,e,f,n,g)})};Glob.prototype._processGlobStar2=function(a,b,c,d,e,f,g,h){if(!g)return h();b=d.slice(1);a=a?[a]:[];var l=a.concat(b);this._process(l,e,!1,h);l=g.length;if(this.symlinks[c]&&f)return h();for(c=0;c<l;c++)if("."!==g[c].charAt(0)||this.dot)f=a.concat(g[c],b),this._process(f,e,!0,h),f=a.concat(g[c],d),this._process(f,e,!0,h);h()};
Glob.prototype._processSimple=function(a,b,c){var d=this;this._stat(a,function(e,f){d._processSimple2(a,b,e,f,c)})};Glob.prototype._processSimple2=function(a,b,c,d,e){this.matches[b]||(this.matches[b]=Object.create(null));if(!d)return e();a&&isAbsolute(a)&&!this.nomount&&(c=/[\/\\]$/.test(a),"/"===a.charAt(0)?a=path.join(this.root,a):(a=path.resolve(this.root,a),c&&(a+="/")));"win32"===process.platform&&(a=a.replace(/\\/g,"/"));this._emitMatch(b,a);e()};
Glob.prototype._stat=function(a,b){var c=this._makeAbs(a),d="/"===a.slice(-1);if(a.length>this.maxLength)return b();if(!this.stat&&ownProp(this.cache,c)){var e=this.cache[c];Array.isArray(e)&&(e="DIR");if(!d||"DIR"===e)return b(null,e);if(d&&"FILE"===e)return b()}e=this.statCache[c];if(void 0!==e){if(!1===e)return b(null,e);var f=e.isDirectory()?"DIR":"FILE";return d&&"FILE"===f?b():b(null,f,e)}var g=this;(d=inflight("stat\x00"+c,function(d,e){if(e&&e.isSymbolicLink())return fs.stat(c,function(d,
f){d?g._stat2(a,c,null,e,b):g._stat2(a,c,d,f,b)});g._stat2(a,c,d,e,b)}))&&fs.lstat(c,d)};Glob.prototype._stat2=function(a,b,c,d,e){if(c)return this.statCache[b]=!1,e();a="/"===a.slice(-1);this.statCache[b]=d;if("/"===b.slice(-1)&&!d.isDirectory())return e(null,!1,d);c=d.isDirectory()?"DIR":"FILE";this.cache[b]=this.cache[b]||c;return a&&"DIR"!==c?e():e(null,c,d)}; //# sourceMappingURL=glob.js.map
