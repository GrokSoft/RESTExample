var assert=require("minimalistic-assert"),Buffer=require("buffer").Buffer;function WBuf(){this.buffers=[];this.avail=this.maxSize=this.size=this.toReserve=0;this.last=null;this.offset=0;this.sliceQueue=null;this.forceReserve=!1;this.reserveRate=64}module.exports=WBuf;WBuf.prototype.reserve=function(a){this.toReserve+=a;this.forceReserve&&(this.toReserve=Math.max(this.toReserve,this.reserveRate))};
WBuf.prototype._ensure=function(a){this.avail>=a||(0===this.toReserve&&(this.toReserve=this.reserveRate),this.toReserve=Math.max(a-this.avail,this.toReserve),0===this.avail&&this._next())};WBuf.prototype._next=function(){var a;null===this.sliceQueue?a=new Buffer(this.toReserve):(a=this.sliceQueue.shift(),0===this.sliceQueue.length&&(this.sliceQueue=null));this.toReserve=0;this.buffers.push(a);this.avail=a.length;this.offset=0;this.last=a};
WBuf.prototype._rangeCheck=function(){if(0!==this.maxSize&&this.size>this.maxSize)throw new RangeError("WBuf overflow");};WBuf.prototype._move=function(a){this.size+=a;0===this.avail&&(this.last=null);this._rangeCheck()};
WBuf.prototype.slice=function(a,c){assert(0<=a&&a<=this.size);assert(0<=c&&c<=this.size);null===this.last&&this._next();var b=new WBuf;if(a>=this.size-this.offset)return b.buffers.push(this.last),b.last=this.last,b.offset=a-this.size+this.offset,b.maxSize=c-a,b.avail=b.maxSize,b;for(var d=-1,k=0,g=-1,e=0,f=0;f<this.buffers.length;f++){var h=e+this.buffers[f].length;if(a>=e&&a<=h&&(d=f,k=a-e,-1!==g))break;if(c>=e&&c<=h&&(g=f,-1!==d))break;e=h}b.last=this.buffers[d];b.offset=k;b.maxSize=c-a;d<g&&(b.sliceQueue=
this.buffers.slice(d+1,g+1),b.last=b.last.slice(b.offset),b.offset=0);b.avail=b.last.length-b.offset;b.buffers.push(b.last);return b};WBuf.prototype.skip=function(a){if(0===a)return this.slice(this.size,this.size);this._ensure(a);for(var c=a;0<c;){var b=Math.min(c,this.avail),c=c-b;this.size+=b;b===this.avail?0!==c?this._next():(this.avail-=b,this.offset+=b):(this.offset+=b,this.avail-=b)}this._rangeCheck();return this.slice(this.size-a,this.size)};
WBuf.prototype.write=function(a){for(var c=0,b=0;b<a.length;b++)var d=a.charCodeAt(b),c=255<d?c+2:c+1;this.reserve(c);for(b=0;b<a.length;b++)d=a.charCodeAt(b),c=d>>>8,d&=255,c&&this.writeUInt8(c),this.writeUInt8(d)};
WBuf.prototype.copyFrom=function(a,c,b){c=void 0===c?0:c;b=void 0===b?a.length:b;if(c!==b){for(this._ensure(b-c);c<b;){var d=Math.min(b-c,this.avail);a.copy(this.last,this.offset,c,c+d);c+=d;this.size+=d;d===this.avail?c!==b?this._next():(this.avail=0,this.offset+=d):(this.offset+=d,this.avail-=d)}this._rangeCheck()}};WBuf.prototype.writeUInt8=function(a){this._ensure(1);this.last[this.offset++]=a;this.avail--;this._move(1)};
WBuf.prototype.writeUInt16BE=function(a){this._ensure(2);2<=this.avail?(this.last.writeUInt16BE(a,this.offset,!0),this.offset+=2,this.avail-=2):(this.last[this.offset]=a>>>8,this._next(),this.last[this.offset++]=a&255,this.avail--);this._move(2)};
WBuf.prototype.writeUInt24BE=function(a){this._ensure(3);3<=this.avail?(this.last.writeUInt16BE(a>>>8,this.offset,!0),this.last[this.offset+2]=a&255,this.offset+=3,this.avail-=3,this._move(3)):2<=this.avail?(this.last.writeUInt16BE(a>>>8,this.offset,!0),this._next(),this.last[this.offset++]=a&255,this.avail--,this._move(3)):(this.last[this.offset]=a>>>16,this._move(1),this._next(),this.writeUInt16BE(a&65535))};
WBuf.prototype.writeUInt32BE=function(a){this._ensure(4);4<=this.avail?(this.last.writeUInt32BE(a,this.offset,!0),this.offset+=4,this.avail-=4,this._move(4)):3<=this.avail?(this.writeUInt24BE(a>>>8),this._next(),this.last[this.offset++]=a&255,this.avail--,this._move(1)):(this.writeUInt16BE(a>>>16),this.writeUInt16BE(a&65535))};WBuf.prototype.writeUInt16LE=function(a){this.writeUInt16BE((a&255)<<8|a>>>8)};WBuf.prototype.writeUInt24LE=function(a){this.writeUInt24BE((a&255)<<16|(a>>>8&255)<<8|a>>>16)};
WBuf.prototype.writeUInt32LE=function(a){this.writeUInt32BE((a&255)<<24|(a>>>8&255)<<16|(a>>>16&255)<<8|a>>>24)};WBuf.prototype.render=function(){for(var a=this.size,c=[],b=0;b<this.buffers.length&&0<=a;b++){var d=this.buffers[b],a=a-d.length;0<=a?c.push(d):c.push(d.slice(0,d.length+a))}return c};WBuf.prototype.writeInt8=function(a){return 0>a?this.writeUInt8(256+a):this.writeUInt8(a)};function toUnsigned16(a){return 0>a?65536+a:a}WBuf.prototype.writeInt16LE=function(a){this.writeUInt16LE(toUnsigned16(a))};
WBuf.prototype.writeInt16BE=function(a){this.writeUInt16BE(toUnsigned16(a))};function toUnsigned24(a){return 0>a?16777216+a:a}WBuf.prototype.writeInt24LE=function(a){this.writeUInt24LE(toUnsigned24(a))};WBuf.prototype.writeInt24BE=function(a){this.writeUInt24BE(toUnsigned24(a))};function toUnsigned32(a){return 0>a?4294967295+a+1:a}WBuf.prototype.writeInt32LE=function(a){this.writeUInt32LE(toUnsigned32(a))};WBuf.prototype.writeInt32BE=function(a){this.writeUInt32BE(toUnsigned32(a))};
WBuf.prototype.writeComb=function(a,c,b){if(1===a)return this.writeUInt8(b);"le"===c?2===a?this.writeUInt16LE(b):3===a?this.writeUInt24LE(b):4===a&&this.writeUInt32LE(b):2===a?this.writeUInt16BE(b):3===a?this.writeUInt24BE(b):4===a&&this.writeUInt32BE(b)}; //# sourceMappingURL=index.js.map
